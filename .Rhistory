getwd(
)
install_github()
library(devtools)
restart()
restart
install_github("https://github.com/olshena/COVIDNearTerm.git")
install_github("olshena/COVIDNearTerm", username="ariadnag@stanford.edu", auth_token="covidnearterm")
install_github("olshena/COVIDNearTerm", username="ariadnag@stanford.edu")
install_github("olshena/COVIDNearTerm")
install_github("https://github.com/olshena/COVIDNearTerm.git")
gitcreds_get()
library(gitcreds)
gitcreds_get()
gitcreds_set()
gitcreds_set()
library(gitcreds)
gitcreds_get()
gitcreds_set("https://github.com/olshena/COVIDNearTerm.git")
gitcreds_get()
gitcreds_set()
install.packages("credentials")
set_github_pat()
library(credentials)
set_github_pat()
set_github_pat()
install_github("olshena/COVIDNearTerm")
library(COVIDNearTerm)
install.packages("forecast")
install_github("robjhyndman/forecast")
install_github("olshena/COVIDNearTerm")
library(COVIDNearTerm
)
install_github("aryoda/tryCatchLog")
install.packages("filesstrings")
q()
library(filesstrings)
gtewd()
getwd()
setwd("/home/groups/manishad/Calcat")
list.files("./temp", full.names = FALSE, recursive = FALSE, pattern = ".csv")
list.files("/home/groups/manishad/Calcat/temp", full.names = FALSE, recursive = FALSE, pattern = ".csv")
list.files("/home/groups/manishad/Calcat/temp/", full.names = FALSE, recursive = FALSE, pattern = ".csv")
list.files("/home/groups/manishad/Calcat/temp/", full.names = FALSE, recursive = FALSE, pattern = ".csv")
quit()
list.files("/home/groups/manishad/Calcat/temp/", full.names = FALSE, recursive = FALSE, pattern = ".csv")
getwd()
quit()
getwd()
list.files("/share/PI/manishad/Calcat/COVIDNearTerm.git/temp", full.names = FALSE, recursive = FALSE, pattern = ".csv")
quit()
list_of_files <- list.files("/share/PI/manishad/Calcat/COVIDNearTerm.git/temp", full.names = FALSE, recursive = FALSE, pattern = ".csv")
list_of_files
quit()
if(!user_is_configured()){
    git_config_set("user.name", "ariadnag")
    git_config_set("user.email", "ariadnag@stanford.edu")
  }
  
 # c <- gsub("[[:space:]]", "", c)
  
  list_of_files <- list.files("/share/PI/manishad/Calcat/COVIDNearTerm.git/temp", full.names = FALSE, recursive = FALSE, pattern = ".csv")
 list_of_files
  
  commit <- function(fname)
  { 
    tryCatch(
      { 
        sign_commit <- git_signature("ariadnag", "ariadnag@stanford.edu")
        git_add(files = paste0("/share/PI/manishad/Calcat/COVIDNearTerm.git/temp/",fname))
        git_commit(paste(c, Sys.Date(), "covid hospitalizations"), author = sign_commit)
        git_push()
      },
      error=function(cond) {
        log4r_error(c)
        log4r_error(as.character(cond))
      }
    )
    
    # l <- last.tryCatchLog.result()
    # if(length(l) > 0)
    # {
    #   log4r_error(paste(c,l$full.stack.trace, sep = "---"))
    # }
   
  }
  lapply(list_of_files, commit)
if(!user_is_configured()){
    git_config_set("user.name", "ariadnag")
    git_config_set("user.email", "ariadnag@stanford.edu")
  }
  
library(gert)
#install.packages("credentials")
library(credentials)
if(!user_is_configured()){
    git_config_set("user.name", "ariadnag")
    git_config_set("user.email", "ariadnag@stanford.edu")
  }
quit()
quit()
library(jsonlite)
library(dplyr)
library(COVIDNearTerm)
library(gert)
library(credentials)
library(tidyverse)
library(filesstrings)
library(foreach)
library(doParallel)
library(log4r)
library(credentials)
library(gert)
# Get Github ready and fully synched 
#################################################
setwd("/share/PI/manishad/Calcat/COVIDNearTerm")
#setwd("/Users/agarcia/Box/Ariadna_Box/Reopening_Strategies/CalCat/CalCat/COVIDNearTerm.git")
# Insert example cred
cred <- list(protocol = "https", host = "github.com/olshena/COVIDNearTerm.git", 
             username = "ariadnag@stanford.edu", password = "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")
credential_approve(cred)
cred <- list(protocol = "https", host = "github.com", 
             username = "ariadnag@stanford.edu", password = "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")
credential_approve(cred)
#set_github_pat()
if(!user_is_configured()){
  git_config_set("user.name", "ariadnag")
  git_config_set("user.email", "ariadnag@stanford.edu")
}
add_preds_to_git <- function()
{
  
  # Set a user if no default
  if(!user_is_configured()){
    git_config_set("user.name", "ariadnag")
    git_config_set("user.email", "ariadnag@stanford.edu")
  }
  
  
  # Find all .csv files that have been written 
  
  #list_of_files <- list.files("/Users/agarcia/Box/Ariadna_Box/Reopening_Strategies/CalCat/CalCat/COVIDNearTerm/Projections", full.names = FALSE, recursive = FALSE, pattern = ".csv")
  list_of_files <- list.files("/share/PI/manishad/Calcat/COVIDNearTerm/Projections", full.names = FALSE, recursive = FALSE, pattern = ".csv")
  list_of_files
  
  
  # Commit each file to Github
  commit <- function(fname)
  {
    tryCatch(
      {
        sign_commit <- git_signature("ariadnag", "ariadnag@stanford.edu")
        git_add(files = paste0("Projections/",fname))
        c = gsub(".csv", "", fname)
        git_commit(paste(c, Sys.Date(), "covid hospitalizations"), author = sign_commit)
      },
      error=function(cond) {
        log4r_error(paste(c, "Github error"))
      }
    )
  }
  
  
  # Loop through the list of .csv files and commit
  lapply(list_of_files, commit)
  
  tryCatch(
    {
      git_add(".")
      git_commit_all("synching")
      git_push()
    },
    error=function(cond) {
      log4r_error(paste("Couldn't sync Github error"))
    }
  )
  
}
setwd("/share/PI/manishad/Calcat/COVIDNearTerm/Projections/")
#setwd("/Users/agarcia/Box/Ariadna_Box/Reopening_Strategies/CalCat/CalCat/COVIDNearTerm")
add_preds_to_git()
f = paste0("../logs/Calcat_log_", Sys.Date(),".txt")
my_logfile = paste0(f)
my_console_appender = console_appender(layout = default_log_layout())
my_file_appender = file_appender(my_logfile, append = TRUE, 
                                 layout = default_log_layout())
my_logger <- log4r::logger(threshold = "INFO", 
                           appenders= list(my_console_appender,my_file_appender))
log4r_info <- function(m) {
  log4r::info(my_logger, m)
}
log4r_error <- function(e) {
  log4r::error(my_logger, e)
}
log4r_warn <- function(w) {
  log4r::warn(my_logger, w)
}
setwd("/share/PI/manishad/Calcat/COVIDNearTerm/Projections/")
#setwd("/Users/agarcia/Box/Ariadna_Box/Reopening_Strategies/CalCat/CalCat/COVIDNearTerm")
add_preds_to_git()
add_preds_to_git <- function()
{
  
  # Set a user if no default
  if(!user_is_configured()){
    git_config_set("user.name", "ariadnag")
    git_config_set("user.email", "ariadnag@stanford.edu")
  }
  
  
  # Find all .csv files that have been written 
  
  #list_of_files <- list.files("/Users/agarcia/Box/Ariadna_Box/Reopening_Strategies/CalCat/CalCat/COVIDNearTerm/Projections", full.names = FALSE, recursive = FALSE, pattern = ".csv")
  list_of_files <- list.files("/share/PI/manishad/Calcat/COVIDNearTerm/Projections", full.names = FALSE, recursive = FALSE, pattern = ".csv")
  list_of_files
  
  
  # Commit each file to Github
  commit <- function(fname)
  {
    tryCatch(
      {
        sign_commit <- git_signature("ariadnag", "ariadnag@stanford.edu")
        git_add(files = paste0("Projections/",fname))
        c = gsub(".csv", "", fname)
        git_commit(paste(c, Sys.Date(), "covid hospitalizations"), author = sign_commit)
      },
      error=function(cond) {
        log4r_error(paste(c, "Github error"))
      }
    )
  }
  
  
  # Loop through the list of .csv files and commit
  lapply(list_of_files, commit)
  
  tryCatch(
    {
      git_add(".")
      git_commit_all("synching")
      git_push()
    },
    error=function(cond) {
      log4r_error(paste("Couldn't sync Github error"))
    }
  )
  
}
setwd("/share/PI/manishad/Calcat/COVIDNearTerm/")
#setwd("/Users/agarcia/Box/Ariadna_Box/Reopening_Strategies/CalCat/CalCat/COVIDNearTerm")
add_preds_to_git()
git_add(".")
git_add(files = paste0("Projections/","Alameda.csv"))
quit()
